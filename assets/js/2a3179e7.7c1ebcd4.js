"use strict";(self.webpackChunknotes_3_5_2=self.webpackChunknotes_3_5_2||[]).push([[4968],{6599:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var r=t(4848),s=t(8453);const i={},a="gitea",o={id:"gitea",title:"gitea",description:"gitea",source:"@site/notes/docker/gitea.md",sourceDirName:".",slug:"/gitea",permalink:"/notes/docker/gitea",draft:!1,unlisted:!1,tags:[],version:"current",frontMatter:{},sidebar:"tutorialSidebar",previous:{title:"frp",permalink:"/notes/docker/frp"},next:{title:"API tool: httpbin hoppscotch",permalink:"/notes/docker/hoppscotch"}},l={},c=[{value:"gitea",id:"gitea-1",level:2},{value:"docker-compose.yml",id:"docker-composeyml",level:2},{value:".gitea/workflows/pull_on_push.yml",id:"giteaworkflowspull_on_pushyml",level:2}];function d(n){const e={a:"a",code:"code",h1:"h1",h2:"h2",header:"header",li:"li",pre:"pre",ul:"ul",...(0,s.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.header,{children:(0,r.jsx)(e.h1,{id:"gitea",children:"gitea"})}),"\n",(0,r.jsx)(e.h2,{id:"gitea-1",children:(0,r.jsx)(e.a,{href:"https://docs.gitea.com/zh-cn/installation/install-with-docker#postgresql-%E6%95%B0%E6%8D%AE%E5%BA%93",children:"gitea"})}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["\u8bbe\u7f6e\u90fd\u6709\u7ea7\u522b,\u5982","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsxs)(e.li,{children:["Runner:","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5b9e\u4f8b\u7ea7\u522b\uff1aRunner\u5c06\u4e3a\u5b9e\u4f8b\u4e2d\u7684\u6240\u6709\u5b58\u50a8\u5e93\u8fd0\u884cJob\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u7ec4\u7ec7\u7ea7\u522b\uff1aRunner\u5c06\u4e3a\u7ec4\u7ec7\u4e2d\u7684\u6240\u6709\u5b58\u50a8\u5e93\u8fd0\u884cJob\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u5b58\u50a8\u5e93\u7ea7\u522b\uff1aRunner\u5c06\u4e3a\u5176\u6240\u5c5e\u7684\u5b58\u50a8\u5e93\u8fd0\u884cJob\u3002"}),"\n",(0,r.jsxs)(e.li,{children:["\u9700\u8981\u5728 Gitea \u4e2d\u6ce8\u518c Runner, \u9700\u8981\u5728 Gitea \u7684 Web UI \u4e2d\u83b7\u53d6 ",(0,r.jsx)(e.code,{children:"GITEA_RUNNER_REGISTRATION_TOKEN"}),"\u3002"]}),"\n"]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsxs)(e.li,{children:["\u53d8\u91cf","\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u5bc6\u94a5: secrets"}),"\n",(0,r.jsx)(e.li,{children:"\u53d8\u91cf: vars"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"docker-composeyml",children:"docker-compose.yml"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'# ssh example: ssh://git@git.hjkl01.cn:33030/admin/project.git\n\nversion: "3"\n\nnetworks:\n  gitea-net:\n\nservices:\n  gitea:\n    image: docker.gitea.com/gitea:1.23.6\n    container_name: gitea\n    environment:\n      - USER_UID=1000\n      - USER_GID=1000\n    restart: always\n    volumes:\n      - ./data/gitea:/data\n    ports:\n      - "3000:3000"   # Web UI\n      - "22222:22"\n    networks:\n      - gitea-net\n\n  act_runner:\n    # image: gitea/act_runner:latest\n    image: gitea/act_runner:nightly\n    container_name: gitea_act_runner\n    restart: always\n    depends_on:\n      - gitea\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n      - ./data/runner:/data\n    environment:\n      - GITEA_INSTANCE_URL=http://gitea:3030\n      - GITEA_RUNNER_REGISTRATION_TOKEN=\u542f\u52a8\u540e\u5728 Gitea \u4e2d\u6ce8\u518c Runner\n      - GITEA_RUNNER_NAME=runner-docker\n      - GITEA_RUNNER_LABELS=docker:docker\n    networks:\n      - gitea-net\n'})}),"\n",(0,r.jsx)(e.h2,{id:"giteaworkflowspull_on_pushyml",children:".gitea/workflows/pull_on_push.yml"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-yaml",children:'name: Deploy to Multiple Servers\n\non:\n  push:\n    branches: [ main ]\n\njobs:\n  deploy:\n    runs-on: docker\n    container:\n      image: alpine:3.20\n    env:\n      SERVER_USER: ${{ vars.USER }}\n      SERVER_IP: ${{ vars.SERVER_IP }}\n    steps:\n      - name: Update apk mirrors (TUNA mirror)\n        run: |\n          sed -i \'s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g\' /etc/apk/repositories\n          apk update\n\n      - name: Install ssh client & git\n        run: apk add --no-cache openssh-client git\n\n      - name: Setup SSH key\n        run: |\n          mkdir -p ~/.ssh\n          echo "${{ secrets.SSH_PRIVATE_KEY }}" > ~/.ssh/id_ed25519\n          chmod 600 ~/.ssh/id_ed25519\n\n          touch ~/.ssh/known_hosts\n          ssh-keyscan -p 22 $(echo ${{ vars.SERVER_IP }} | cut -d@ -f2) >> ~/.ssh/known_hosts 2>/dev/null || true\n\n      - name: Debug variables\n        run: |\n          echo "Server user: $SERVER_USER"\n          echo "Server IP: $SERVER_IP"\n\n      - name: Deploy via SSH\n        run: |\n          ssh -i ~/.ssh/id_ed25519 $SERVER_USER@$SERVER_IP "cd /some_dir && git pull"\n'})})]})}function u(n={}){const{wrapper:e}={...(0,s.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(d,{...n})}):d(n)}},8453:(n,e,t)=>{t.d(e,{R:()=>a,x:()=>o});var r=t(6540);const s={},i=r.createContext(s);function a(n){const e=r.useContext(i);return r.useMemo(function(){return"function"==typeof n?n(e):{...e,...n}},[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(s):n.components||s:a(n.components),r.createElement(i.Provider,{value:e},n.children)}}}]);