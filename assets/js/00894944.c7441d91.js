"use strict";(self.webpackChunkdocusaurus_classic_typescript=self.webpackChunkdocusaurus_classic_typescript||[]).push([[3488],{3905:(e,n,r)=>{r.d(n,{Zo:()=>d,kt:()=>u});var o=r(67294);function t(e,n,r){return n in e?Object.defineProperty(e,n,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[n]=r,e}function a(e,n){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);n&&(o=o.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),r.push.apply(r,o)}return r}function i(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{};n%2?a(Object(r),!0).forEach((function(n){t(e,n,r[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):a(Object(r)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(r,n))}))}return e}function s(e,n){if(null==e)return{};var r,o,t=function(e,n){if(null==e)return{};var r,o,t={},a=Object.keys(e);for(o=0;o<a.length;o++)r=a[o],n.indexOf(r)>=0||(t[r]=e[r]);return t}(e,n);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)r=a[o],n.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(t[r]=e[r])}return t}var l=o.createContext({}),c=function(e){var n=o.useContext(l),r=n;return e&&(r="function"==typeof e?e(n):i(i({},n),e)),r},d=function(e){var n=c(e.components);return o.createElement(l.Provider,{value:n},e.children)},p={inlineCode:"code",wrapper:function(e){var n=e.children;return o.createElement(o.Fragment,{},n)}},m=o.forwardRef((function(e,n){var r=e.components,t=e.mdxType,a=e.originalType,l=e.parentName,d=s(e,["components","mdxType","originalType","parentName"]),m=c(r),u=t,_=m["".concat(l,".").concat(u)]||m[u]||p[u]||a;return r?o.createElement(_,i(i({ref:n},d),{},{components:r})):o.createElement(_,i({ref:n},d))}));function u(e,n){var r=arguments,t=n&&n.mdxType;if("string"==typeof e||t){var a=r.length,i=new Array(a);i[0]=m;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:t,i[1]=s;for(var c=2;c<a;c++)i[c]=r[c];return o.createElement.apply(null,i)}return o.createElement.apply(null,r)}m.displayName="MDXCreateElement"},62995:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>l,contentTitle:()=>i,default:()=>p,frontMatter:()=>a,metadata:()=>s,toc:()=>c});var o=r(87462),t=(r(67294),r(3905));const a={sidebar_position:2},i="cloudreve minIO alist",s={unversionedId:"cloudreve",id:"cloudreve",title:"cloudreve minIO alist",description:"cloudreve",source:"@site/notes/docker/cloudreve.md",sourceDirName:".",slug:"/cloudreve",permalink:"/notes/docker/cloudreve",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"ddns",permalink:"/notes/docker/ddns"},next:{title:"samba nfs",permalink:"/notes/docker/samba"}},l={},c=[{value:"cloudreve",id:"cloudreve",level:2},{value:"nginx",id:"nginx",level:3},{value:"minIO",id:"minio",level:2},{value:"nginx",id:"nginx-1",level:3},{value:"alist",id:"alist",level:2}],d={toc:c};function p(e){let{components:n,...r}=e;return(0,t.kt)("wrapper",(0,o.Z)({},d,r,{components:n,mdxType:"MDXLayout"}),(0,t.kt)("h1",{id:"cloudreve-minio-alist"},"cloudreve minIO alist"),(0,t.kt)("h2",{id:"cloudreve"},"cloudreve"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},'# office \u6587\u6863\u9884\u89c8\u670d\u52a1\n# https://view.xdocin.com/view?src={$src}\n\n# mkdir -vp cloudreve/{uploads,avatar} \\\n    && touch cloudreve/conf.ini \\\n    && touch cloudreve/cloudreve.db \\\n    && mkdir -p aria2/config \\\n    && mkdir -p data/aria2 \\\n    && chmod -R 777 data/aria2\n\nversion: "3.8"\nservices:\n  cloudreve:\n    container_name: cloudreve\n    image: cloudreve/cloudreve:latest\n    restart: unless-stopped\n    ports:\n      - "5212:5212"\n    volumes:\n      - ./data/aria2/downloads:/downloads\n      - ./data/cloudreve/uploads:/cloudreve/uploads\n      - ./data/cloudreve/conf.ini:/cloudreve/conf.ini\n      - ./data/cloudreve/cloudreve.db:/cloudreve/cloudreve.db\n      - ./data/cloudreve/avatar:/cloudreve/avatar\n    depends_on:\n      - Aria2-Pro\n\n  Aria2-Pro:\n    container_name: aria2-pro\n    image: p3terx/aria2-pro\n    environment:\n      - PUID=65534\n      - PGID=65534\n      - UMASK_SET=022\n      - RPC_SECRET=0b5c74bcc83fc89f29b6f9f4e8a812ef87f69258\n      - RPC_PORT=6800\n      - LISTEN_PORT=6888\n      - DISK_CACHE=64M\n      - IPV6_MODE=true\n      - UPDATE_TRACKERS=true\n      # - CUSTOM_TRACKER_URL=\n      - TZ=Asia/Shanghai\n    volumes:\n      - ./data/aria2/config:/config\n      - ./data/aria2/downloads:/downloads\n    restart: unless-stopped\n    ports:\n     - 16800:6800\n     - 16888:6888\n     - 16888:6888/udp\n    logging:\n      driver: json-file\n      options:\n        max-size: 1m\n\n')),(0,t.kt)("h3",{id:"nginx"},"nginx"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},"server {\n    listen 15212 ssl http2;\n    listen [::]:15212 ssl http2;\n    server_name hjkl01.cn;\n\n    ssl_certificate  /etc/nginx/cert/hjkl01.cn_nginx/hjkl01.cn_bundle.crt;\n    ssl_certificate_key /etc/nginx/cert/hjkl01.cn_nginx/hjkl01.cn.key;\n    ssl_session_timeout 5m;\n    ssl_ciphers ECDHE-RSA-AES128-GCM-SHA256:ECDHE:ECDH:AES:HIGH:!NULL:!aNULL:!MD5:!ADH:!RC4;\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_prefer_server_ciphers on;\n\n    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n    proxy_set_header Host $http_host;\n    proxy_redirect off;\n    client_max_body_size 90000m;\n\n    location / {\n        proxy_pass http://192.168.50.4:5212;\n    }\n}\n")),(0,t.kt)("h2",{id:"minio"},"minIO"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},'version: \'3.7\'\n\n# Settings and configurations that are common for all containers\nx-minio-common: &minio-common\n  image: quay.io/minio/minio:RELEASE.2022-05-23T18-45-11Z\n  command: server --console-address ":9001" http://minio{1...4}/data{1...2}\n  environment:\n    - MINIO_ROOT_USER=username\n    - MINIO_ROOT_PASSWORD=password\n  expose:\n    - "9000"\n    - "9001"\n  healthcheck:\n    test: ["CMD", "curl", "-f", "http://localhost:9000/minio/health/live"]\n    interval: 30s\n    timeout: 20s\n    retries: 3\n\n# starts 4 docker containers running minio server instances.\n# using nginx reverse proxy, load balancing, you can access\n# it through port 9000.\nservices:\n  minio1:\n    <<: *minio-common\n    hostname: minio1\n    volumes:\n      - ./data/minio/data1-1:/data1\n      - ./data/minio/data1-2:/data2\n\n  minio2:\n    <<: *minio-common\n    hostname: minio2\n    volumes:\n      - ./data/minio/data2-1:/data1\n      - ./data/minio/data2-2:/data2\n\n  minio3:\n    <<: *minio-common\n    hostname: minio3\n    volumes:\n      - ./data/minio/data3-1:/data1\n      - ./data/minio/data3-2:/data2\n\n  minio4:\n    <<: *minio-common\n    hostname: minio4\n    volumes:\n      - ./data/minio/data4-1:/data1\n      - ./data/minio/data4-2:/data2\n\n  nginx:\n    image: nginx:1.19.2-alpine\n    hostname: nginx\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf:ro\n    ports:\n      - "9000:9000"\n      - "9002:9001"\n    depends_on:\n      - minio1\n      - minio2\n      - minio3\n      - minio4\n')),(0,t.kt)("h3",{id:"nginx-1"},"nginx"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-shell"},'user  nginx;\nworker_processes  auto;\n\nerror_log  /var/log/nginx/error.log warn;\npid        /var/run/nginx.pid;\n\nevents {\n    worker_connections  4096;\n}\n\nhttp {\n    include       /etc/nginx/mime.types;\n    default_type  application/octet-stream;\n\n    log_format  main  \'$remote_addr - $remote_user [$time_local] "$request" \'\n                      \'$status $body_bytes_sent "$http_referer" \'\n                      \'"$http_user_agent" "$http_x_forwarded_for"\';\n\n    access_log  /var/log/nginx/access.log  main;\n    sendfile        on;\n    keepalive_timeout  65;\n\n    # include /etc/nginx/conf.d/*.conf;\n\n    upstream minio {\n        server minio1:9000;\n        server minio2:9000;\n        server minio3:9000;\n        server minio4:9000;\n    }\n\n    upstream console {\n        ip_hash;\n        server minio1:9001;\n        server minio2:9001;\n        server minio3:9001;\n        server minio4:9001;\n    }\n\n    server {\n        listen       9000;\n        listen  [::]:9000;\n        server_name  localhost;\n\n        # To allow special characters in headers\n        ignore_invalid_headers off;\n        # Allow any size file to be uploaded.\n        # Set to a value such as 1000m; to restrict file size to a specific value\n        client_max_body_size 0;\n        # To disable buffering\n        proxy_buffering off;\n        proxy_request_buffering off;\n\n        location / {\n            proxy_set_header Host $http_host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n\n            proxy_connect_timeout 300;\n            # Default is HTTP/1, keepalive is only enabled in HTTP/1.1\n            proxy_http_version 1.1;\n            proxy_set_header Connection "";\n            chunked_transfer_encoding off;\n\n            proxy_pass http://minio;\n        }\n    }\n\n    server {\n        listen       9001;\n        listen  [::]:9001;\n        server_name  localhost;\n\n        # To allow special characters in headers\n        ignore_invalid_headers off;\n        # Allow any size file to be uploaded.\n        # Set to a value such as 1000m; to restrict file size to a specific value\n        client_max_body_size 0;\n        # To disable buffering\n        proxy_buffering off;\n        proxy_request_buffering off;\n\n        location / {\n            proxy_set_header Host $http_host;\n            proxy_set_header X-Real-IP $remote_addr;\n            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n            proxy_set_header X-Forwarded-Proto $scheme;\n            proxy_set_header X-NginX-Proxy true;\n\n            # This is necessary to pass the correct IP to be hashed\n            real_ip_header X-Real-IP;\n\n            proxy_connect_timeout 300;\n            \n            # To support websocket\n            proxy_http_version 1.1;\n            proxy_set_header Upgrade $http_upgrade;\n            proxy_set_header Connection "upgrade";\n            \n            chunked_transfer_encoding off;\n\n            proxy_pass http://console;\n        }\n    }\n}\n')),(0,t.kt)("h2",{id:"alist"},"alist"),(0,t.kt)("pre",null,(0,t.kt)("code",{parentName:"pre",className:"language-yaml"},'version: "3.8"\nservices:\n  cloudreve:\n    container_name: alist\n    image: xhofe/alist:latest\n    restart: unless-stopped\n    ports:\n      - "5244:5244"\n    volumes:\n      - ./data/alist:/opt/alist/data\n      - /some_dir:/mnt\n')))}p.isMDXComponent=!0}}]);